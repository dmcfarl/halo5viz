<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Insert title here</title>
<link rel="stylesheet"
	href="http://openlayers.org/en/v3.15.1/css/ol.css" type="text/css">
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"
	type="text/css">
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
	type="text/css">
<link rel="stylesheet" href="resources/css/com/hobo/bob/layout.css"
	type="text/css">
<link rel="stylesheet"
	href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css"
	type="text/css">
</head>
<body>
	<!-- <script type="text/javascript"
		src="http://openlayers.org/en/v3.15.1/build/ol-debug.js"></script>-->
	<script type="text/javascript"
		src="http://openlayers.org/en/v3.15.1/build/ol.js"></script>

	<div id="layout">
		<div id="map"></div>
		<div id="controls">
			<form>
				<a id="export-png" class="btn btn-default" download="map.png"><i
					class="fa fa-download"></i> Download PNG</a>
				<div id="heatmapControls" class="heatmap">
					<label>radius size</label> <input id="radius" class="control"
						type="range" min="1" max="50" step="1" value="5" /> <label>blur
						size</label> <input id="blur" class="control" type="range" min="1"
						max="50" step="1" value="15" />
				</div>
				<label>MultiKills</label> <input id="multikill" class="control"
					type="range" min="1" max="10" step="1" value="1" />
			</form>
		</div>
	</div>
	<div id="progress" title="Processing...">
		<div id="progressbar">
			<div class="progresslabel">0%</div>
		</div>
	</div>

	<script type="text/javascript"
		src="https://code.jquery.com/jquery-2.2.3.min.js"></script>
	<script type="text/javascript"
		src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
	<script type="text/javascript" src="resources/js/com/hobo/bob/map.js"></script>
	<script type="text/javascript"
		src="resources/js/com/hobo/bob/pointLayer.js"></script>
	<script type="text/javascript"
		src="resources/js/com/hobo/bob/multikill.js"></script>
	<script type="text/javascript"
		src="resources/js/com/hobo/bob/heatmap.js"></script>

	<script type="text/javascript">
		$("#progress").dialog({
			autoOpen : false,
			dialogClass : "no-close",
		});
		$("#progressbar").progressbar({
			value : 0
		});

		var matchesToRetrieve = 100;
		var matchesAdded = 0;
		$("#progress").dialog("open");
		$("#progressbar").progressbar("value", matchesAdded);
		$("#progressbar").progressbar("option", "max", matchesToRetrieve);

		$
				.ajax({
					url : "/Halo_5_Visualization/rest/RetrieveStats/MultiKills",
					data : {
						player : "Hobo I3ob",
						mapName : 'Array',
						numMatches : matchesToRetrieve
					},
					xhrFields : {
						onprogress : function(e) {
							try {
								if (e.lengthComputable) {
									console.log(e.loaded / e.total * 100 + '%');
								}

								var matches = null;
								try {
									matches = $.parseJSON(this.responseText
											+ ']');
								} catch (e) {
									console.log(e);
									matches = $.parseJSON(this.responseText);
								}

								for (matchesAdded; matchesAdded < matches.length; matchesAdded++) {
									loadMultiKills(matches[matchesAdded]);
									$("#progressbar").progressbar("value",
											matchesAdded);
									$(".progresslabel").text(
											matchesAdded + "%");
								}
							} catch (e) {
								console.warn(e);
							}
						}
					},
					success : function(response) {
						$("#progress").dialog("close");
						for (matchesAdded; matchesAdded < response.length; matchesAdded++) {
							loadMultiKills(matches[matchesAdded]);
						}
					},
					error : function() {
						$("#progress").dialog("close");
					}
				});
	</script>

</body>
</html>